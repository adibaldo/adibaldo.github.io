---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';

const pathname = Astro.url.pathname;
const showBrand = pathname !== '/';
---

<header class="site-header" id="site-header">
	<div class="container">
		<nav class="nav" aria-label="Navegação principal">
			<div class="nav-left">
				{showBrand && (
					<a class="nav-brand" href="/">{SITE_TITLE}</a>
				)}
				<div class="nav-links">
					<HeaderLink href="/">Início</HeaderLink>
					<HeaderLink href="/textos">Textos</HeaderLink>
					<HeaderLink href="/locais">Locais</HeaderLink>
					<HeaderLink href="/sobre">Sobre</HeaderLink>
				</div>
			</div>

			<div class="nav-right">
				<a class="icon-btn" href="/buscar" aria-label="Buscar" title="Buscar">
					<svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
						<path
							fill="none"
							stroke="currentColor"
							stroke-width="1.5"
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M21 21l-4.35-4.35m1.85-5.15a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"
						/>
					</svg>
					<span>Buscar</span>
				</a>

				<button class="icon-btn" type="button" id="toggle-reading" aria-label="Modo leitura" title="Modo leitura">
					<svg class="icon" viewBox="0 0 24 24" aria-hidden="true" id="icon-sun">
						<path
							fill="none"
							stroke="currentColor"
							stroke-width="1.5"
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0-16v2m0 16v2m10-10h-2M4 12H2m17.07 7.07-1.41-1.41M8.34 8.34 6.93 6.93m12.14 0-1.41 1.41M8.34 15.66l-1.41 1.41"
						/>
					</svg>
					<svg class="icon" viewBox="0 0 24 24" aria-hidden="true" id="icon-moon" style="display:none">
						<path
							fill="none"
							stroke="currentColor"
							stroke-width="1.5"
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M21 12.2A8.5 8.5 0 1 1 11.8 3a6.5 6.5 0 0 0 9.2 9.2Z"
						/>
					</svg>
					<span>Modo leitura</span>
				</button>
			</div>
		</nav>
	</div>
</header>

<script>
	const header = document.getElementById('site-header');
	const btn = document.getElementById('toggle-reading');
	const sun = document.getElementById('icon-sun');
	const moon = document.getElementById('icon-moon');

	function applyMode(mode) {
		// mode: 'light' | 'dark'
		document.documentElement.dataset.theme = mode;
		const isDark = mode === 'dark';
		document.body.classList.toggle('reading', isDark);
		if (sun) sun.style.display = isDark ? 'none' : 'inline-block';
		if (moon) moon.style.display = isDark ? 'inline-block' : 'none';
	}

	// init
	const saved = localStorage.getItem('alfarrabios_mode');
	applyMode(saved === 'dark' ? 'dark' : 'light');

	btn?.addEventListener('click', () => {
		const current = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
		const next = current === 'dark' ? 'light' : 'dark';
		localStorage.setItem('alfarrabios_mode', next);
		applyMode(next);
	});

	// sticky shadow on scroll
	function onScroll() {
		if (!header) return;
		if (window.scrollY > 8) header.classList.add('scrolled');
		else header.classList.remove('scrolled');
	}
	window.addEventListener('scroll', onScroll, { passive: true });
	onScroll();
</script>
